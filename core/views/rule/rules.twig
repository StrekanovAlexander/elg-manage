{% extends 'templates/layout-wide.twig' %}

{% block content %}
{% if places|length %}
  <form action="{{ path_for('rules.set') }}" method="POST"> 
    <table class="table table-striped table-sm">
      <tr class="bg-dark small text-center text-white">
        <td></td>
        {% for place in places %}
          <th>{{ place.full_name|slice(0, 6)|upper }}</th>
        {% endfor %}
      </tr>
      <tr class="small">
        <td colspan="2" class="bg-secondary text-uppercase text-white">Покупка</td>
        <td colspan="{{ places|length - 1 }}"></td>
      </tr>
      {% for curr in currs %}
        <tr class="small">
          <th>{{ curr.short_name }}</th>
          {% for place in places %}
            {% for rule in rules|filter(rule => rule.place_id == place.id and rule.curr_id == curr.id) %}
              <td class="{{ rule.diff_buy < 0 ? 'orange' : (rule.diff_buy == 0 ? 'white' : 'green') }}">
                <div style="display: flex;">
                  <input class="form-control input-step" name="diff_buy_{{ curr.id }}_{{ place.id }}" id="diff_buy_{{ curr.id }}_{{ place.id }}" type="number" step="1" value="{{ rule.diff_buy }}"  style="text-align: center" readonly>
                  <div>
                    <span class="btn-step">⇑</span>
                    <span class="btn-step">⇓</span>
                  </div>
                </div>  
              </td>
            {% endfor %}
          {% endfor %} 
        </tr>
      {% endfor %}
      <tr class="small">
        <td colspan="2" class="bg-secondary text-uppercase text-white">Продажа</td>
        <td colspan="{{ places|length - 1 }}"></td>
      </tr>
      {% for curr in currs %}
        <tr class="small">
          <th>{{ curr.short_name }}</th>
          {% for place in places %}
            {% for rule in rules|filter(rule => rule.place_id == place.id and rule.curr_id == curr.id) %}
              <td class="{{ rule.diff_sale < 0 ? 'orange' : (rule.diff_buy == 0 ? 'white' : 'green') }}">
                <div style="display: flex;">
                  <input class="form-control input-step" name="diff_sale_{{ curr.id }}_{{ place.id }}" id="diff_sale_{{ curr.id }}_{{ place.id }}" type="number" step="1" value="{{ rule.diff_sale }}" style="text-align: center" readonly>
                  <div>
                    <span class="btn-step">⇑</span>
                    <span class="btn-step">⇓</span>
                  </div>
                </div>  
              </td>
            {% endfor %}
          {% endfor %} 
        </tr>
      {% endfor %}
    </table>
    <button class="btn btn-sm btn-primary ml-2 text-uppercase" type="submit">Сохранить</button>
    {{ csrf.field | raw}}
  </form>
{% endif %}

{% endblock %}